<?php
	define("LAYOUT", "sub");
	define("DOC_TITLE", "코드관리 목록");
?>
<?php require_once $_SERVER["DOCUMENT_ROOT"] . "/site/admin/inc/layout_top.php"; ?>
<?php require_once $_SERVER['DOCUMENT_ROOT'] . "/site/class/service/CodeService.php"; ?>
<?php
	$req_params = Request::getParameters();
	
	DevUtil::consoleLog($req_params);
	$dataListCode = CodeService::getListCode($req_params);
?>
	<form action="code_proc.php" method="post" name="f">
		<input type="hidden" name="work_flag">
		<table class="tbl1 th_center td_center">
			<tr>
				<!--js: btn_all_check-->
				<td class="th"><input class="btn_all_check" type="checkbox" title="전체항목선택"></td>
				<td class="th">code_name</td>
				<td class="th">code</td>
				<td class="th">ref_code</td>
				<td class="th"></td>
			</tr>
			<?php if ($dataListCode->num_rows) { ?>
				<?php while ($data = $dataListCode->fetch_assoc()) { ?>
					<tr>
						<td>
							<input name="id[]" class="btn_check" type="checkbox" title="항목선택" value="<?= $data["id"] ?>">
						</td>
						<td>
							<a href="code_list.html?code_level=<?= $data["code_level"] + 1 ?>&ref_code=<?= $data["code"] ?>">
								<?= $data["code_name"] ?>
							</a>
						</td>
						<td class="align_center"><?= $data["code"] ?></td>
						<td class="align_center"><?= $data["ref_code"] ?></td>
						<td class="align_center">
							<a class="btn btn_small" href="code_write.html?<?=Request::replaceQueryString(array("work_flag" => "edit"))?>">수정</a>
						</td>
					</tr>
				<? } ?>
			<? } else { ?>
				<tr>
					<td colspan="10" class="align_center">
						데이터가 존재하지 않습니다.
					</td>
				</tr>
			<? } ?>
		</table>

		<div class="btn_area1">
			<a class="btn" href="code_write.html?<?=Request::replaceQueryString(array("work_flag" => "write"))?>">등록</a>
			<button class="btn" type="button" onclick="deleteCodes();">삭제</button>
		</div>
	</form>
<?php require_once $_SERVER["DOCUMENT_ROOT"] . "/site/inc/comm_js.php"; ?>
	<script>
		UI.checkAll(".btn_all_check", ".btn_check");
		
		function deleteCodes() {
			var f = document.f;
			f.work_flag.value = "delete";
			if (confirm('<?=Lang::getText("CONFIRM_DELETE")?>')) {
				f.submit();
			}
		}
	</script>
<?php require_once $_SERVER["DOCUMENT_ROOT"] . "/site/admin/inc/layout_btm.php"; ?>